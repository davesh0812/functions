kind: job
metadata:
  name: feature-selection
  tag: ''
  hash: a28a4d6e2384dcc17f878da6566d158df2d0d9f6
  project: default
spec:
  command: ''
  args: []
  image: mlrun/mlrun
  env: []
  default_handler: feature_selection
  entry_points:
    show_values_on_bars:
      name: show_values_on_bars
      doc: ''
      parameters:
      - name: axs
        default: ''
      - name: h_v
        default: v
      - name: space
        default: 0.4
      outputs:
      - default: ''
      lineno: 27
    plot_stat:
      name: plot_stat
      doc: ''
      parameters:
      - name: context
        default: ''
      - name: stat_name
        default: ''
      - name: stat_df
        default: ''
      outputs:
      - default: ''
      lineno: 49
    feature_selection:
      name: feature_selection
      doc: 'Applies selected feature selection statistical functions

        or models on our ''df_artifact''.


        Each statistical function or model will vote for it''s best K selected features.

        If a feature has >= ''min_votes'' votes, it will be selected.'
      parameters:
      - name: context
        doc: the function context.
        default: ''
      - name: df_artifact
        default: ''
      - name: k
        type: int
        doc: 'number of top features to select from each statistical function or model. '
        default: 5
      - name: min_votes
        type: float
        doc: 'minimal number of votes (from a model or by statistical function) needed
          for a feature to be selected. Can be specified by percentage of votes or
          absolute number of votes. '
        default: 0.5
      - name: label_column
        type: str
        doc: ground-truth (y) labels.
        default: null
      - name: stat_filters
        type: list
        doc: 'statistical functions to apply to the features (from sklearn.feature_selection). '
        default:
        - f_classif
        - mutual_info_classif
        - chi2
        - f_regression
      - name: model_filters
        type: dict
        doc: 'models to use for feature evaluation, can be specified by model name
          (ex. LinearSVC), formalized json (contains ''CLASS'', ''FIT'', ''META'')
          or a path to such json file. '
        default:
          LinearSVC: LinearSVC
          LogisticRegression: LogisticRegression
          ExtraTreesClassifier: ExtraTreesClassifier
      - name: max_scaled_scores
        type: bool
        doc: produce feature scores table scaled with max_scaler.
        default: true
      - name: sample_ratio
        type: float
        doc: percentage of the dataset the user whishes to compute the feature selection
          process on.
        default: null
      - name: output_vector_name
        type: float
        doc: creates a new feature vector containing only the identifies features.
        default: null
      - name: ignore_type_errors
        type: bool
        doc: skips datatypes that are neither float or int within the feature vector.
        default: false
      - name: is_feature_vector
        type: bool
        doc: bool stating if the data is passed as a feature vector.
        default: false
      outputs:
      - default: ''
      lineno: 73
  description: ''
  build:
    functionSourceCode: aW1wb3J0IHBhbmRhcyBhcyBwZAppbXBvcnQgbWF0cGxvdGxpYi5weXBsb3QgYXMgcGx0CmltcG9ydCBtbHJ1bi5mZWF0dXJlX3N0b3JlIGFzIGZzCmltcG9ydCBzZWFib3JuIGFzIHNucwppbXBvcnQgbnVtcHkgYXMgbnAKaW1wb3J0IG9zCmltcG9ydCBqc29uCmltcG9ydCBtbHJ1bgoKIyBGZWF0dXJlIHNlbGVjdGlvbiBzdHJhdGVnaWVzCmZyb20gc2tsZWFybi5mZWF0dXJlX3NlbGVjdGlvbiBpbXBvcnQgU2VsZWN0S0Jlc3QKZnJvbSBza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uIGltcG9ydCBTZWxlY3RGcm9tTW9kZWwKCiMgU2NhbGUgZmVhdHVyZSBzY29yZXMKZnJvbSBza2xlYXJuLnByZXByb2Nlc3NpbmcgaW1wb3J0IE1pbk1heFNjYWxlcgoKIyBTS0xlYXJuIGVzdGltYXRvcnMgbGlzdApmcm9tIHNrbGVhcm4udXRpbHMgaW1wb3J0IGFsbF9lc3RpbWF0b3JzCgojIE1MUnVuIHV0aWxzCmZyb20gbWxydW4ubWx1dGlscy5wbG90cyBpbXBvcnQgZ2NmX2NsZWFyCmZyb20gbWxydW4udXRpbHMuaGVscGVycyBpbXBvcnQgY3JlYXRlX2NsYXNzCmZyb20gbWxydW4uYXJ0aWZhY3RzIGltcG9ydCBQbG90QXJ0aWZhY3QKZnJvbSBtbHJ1bi5kYXRhc3RvcmUudGFyZ2V0cyBpbXBvcnQgUGFycXVldFRhcmdldAoKCmRlZiBzaG93X3ZhbHVlc19vbl9iYXJzKGF4cywgaF92PSJ2Iiwgc3BhY2U9MC40KToKICAgIGRlZiBfc2hvd19vbl9zaW5nbGVfcGxvdChheCk6CiAgICAgICAgaWYgaF92ID09ICJ2IjoKICAgICAgICAgICAgZm9yIHAgaW4gYXgucGF0Y2hlczoKICAgICAgICAgICAgICAgIF94ID0gcC5nZXRfeCgpICsgcC5nZXRfd2lkdGgoKSAvIDIKICAgICAgICAgICAgICAgIF95ID0gcC5nZXRfeSgpICsgcC5nZXRfaGVpZ2h0KCkKICAgICAgICAgICAgICAgIHZhbHVlID0gaW50KHAuZ2V0X2hlaWdodCgpKQogICAgICAgICAgICAgICAgYXgudGV4dChfeCwgX3ksIHZhbHVlLCBoYT0iY2VudGVyIikKICAgICAgICBlbGlmIGhfdiA9PSAiaCI6CiAgICAgICAgICAgIGZvciBwIGluIGF4LnBhdGNoZXM6CiAgICAgICAgICAgICAgICBfeCA9IHAuZ2V0X3goKSArIHAuZ2V0X3dpZHRoKCkgKyBmbG9hdChzcGFjZSkKICAgICAgICAgICAgICAgIF95ID0gcC5nZXRfeSgpICsgcC5nZXRfaGVpZ2h0KCkKICAgICAgICAgICAgICAgIHZhbHVlID0gaW50KHAuZ2V0X3dpZHRoKCkpCiAgICAgICAgICAgICAgICBheC50ZXh0KF94LCBfeSwgdmFsdWUsIGhhPSJsZWZ0IikKCiAgICBpZiBpc2luc3RhbmNlKGF4cywgbnAubmRhcnJheSk6CiAgICAgICAgZm9yIGlkeCwgYXggaW4gbnAubmRlbnVtZXJhdGUoYXhzKToKICAgICAgICAgICAgX3Nob3dfb25fc2luZ2xlX3Bsb3QoYXgpCiAgICBlbHNlOgogICAgICAgIF9zaG93X29uX3NpbmdsZV9wbG90KGF4cykKCgpkZWYgcGxvdF9zdGF0KGNvbnRleHQsCiAgICAgICAgICAgICAgc3RhdF9uYW1lLAogICAgICAgICAgICAgIHN0YXRfZGYpOgogICAgZ2NmX2NsZWFyKHBsdCkKCiAgICAjIEFkZCBjaGFydAogICAgYXggPSBwbHQuYXhlcygpCiAgICBzdGF0X2NoYXJ0ID0gc25zLmJhcnBsb3QoeD1zdGF0X25hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgeT0naW5kZXgnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9c3RhdF9kZi5zb3J0X3ZhbHVlcyhzdGF0X25hbWUsIGFzY2VuZGluZz1GYWxzZSkucmVzZXRfaW5kZXgoKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICBheD1heCkKICAgIHBsdC50aWdodF9sYXlvdXQoKQoKICAgIGZvciBwIGluIHN0YXRfY2hhcnQucGF0Y2hlczoKICAgICAgICB3aWR0aCA9IHAuZ2V0X3dpZHRoKCkKICAgICAgICBwbHQudGV4dCg1ICsgcC5nZXRfd2lkdGgoKSwgcC5nZXRfeSgpICsgMC41NSAqIHAuZ2V0X2hlaWdodCgpLAogICAgICAgICAgICAgICAgICd7OjEuMmZ9Jy5mb3JtYXQod2lkdGgpLAogICAgICAgICAgICAgICAgIGhhPSdjZW50ZXInLCB2YT0nY2VudGVyJykKCiAgICBjb250ZXh0LmxvZ19hcnRpZmFjdChQbG90QXJ0aWZhY3QoZid7c3RhdF9uYW1lfScsIGJvZHk9cGx0LmdjZigpKSwKICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9b3MucGF0aC5qb2luKCdwbG90cycsICdmZWF0dXJlX3NlbGVjdGlvbicsIGYne3N0YXRfbmFtZX0uaHRtbCcpKQogICAgZ2NmX2NsZWFyKHBsdCkKCgpkZWYgZmVhdHVyZV9zZWxlY3Rpb24oY29udGV4dCwKICAgICAgICAgICAgICAgICAgICAgIGRmX2FydGlmYWN0LAogICAgICAgICAgICAgICAgICAgICAgazogaW50PTUsCiAgICAgICAgICAgICAgICAgICAgICBtaW5fdm90ZXM6IGZsb2F0PTAuNSwKICAgICAgICAgICAgICAgICAgICAgIGxhYmVsX2NvbHVtbjogc3RyPU5vbmUsCiAgICAgICAgICAgICAgICAgICAgICBzdGF0X2ZpbHRlcnM6IGxpc3Q9WydmX2NsYXNzaWYnLCAnbXV0dWFsX2luZm9fY2xhc3NpZicsICdjaGkyJywgJ2ZfcmVncmVzc2lvbiddLAogICAgICAgICAgICAgICAgICAgICAgbW9kZWxfZmlsdGVyczogZGljdD17J0xpbmVhclNWQyc6ICdMaW5lYXJTVkMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0xvZ2lzdGljUmVncmVzc2lvbic6ICdMb2dpc3RpY1JlZ3Jlc3Npb24nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0V4dHJhVHJlZXNDbGFzc2lmaWVyJzogJ0V4dHJhVHJlZXNDbGFzc2lmaWVyJ30sCiAgICAgICAgICAgICAgICAgICAgICBtYXhfc2NhbGVkX3Njb3JlczogYm9vbD1UcnVlLAogICAgICAgICAgICAgICAgICAgICAgc2FtcGxlX3JhdGlvOiBmbG9hdD1Ob25lLAogICAgICAgICAgICAgICAgICAgICAgb3V0cHV0X3ZlY3Rvcl9uYW1lOiBmbG9hdD1Ob25lLAogICAgICAgICAgICAgICAgICAgICAgaWdub3JlX3R5cGVfZXJyb3JzOiBib29sPUZhbHNlLAogICAgICAgICAgICAgICAgICAgICAgaXNfZmVhdHVyZV92ZWN0b3I6IGJvb2w9RmFsc2UpOgogICAgCiAgICAiIiJBcHBsaWVzIHNlbGVjdGVkIGZlYXR1cmUgc2VsZWN0aW9uIHN0YXRpc3RpY2FsIGZ1bmN0aW9ucwogICAgb3IgbW9kZWxzIG9uIG91ciAnZGZfYXJ0aWZhY3QnLgoKICAgIEVhY2ggc3RhdGlzdGljYWwgZnVuY3Rpb24gb3IgbW9kZWwgd2lsbCB2b3RlIGZvciBpdCdzIGJlc3QgSyBzZWxlY3RlZCBmZWF0dXJlcy4KICAgIElmIGEgZmVhdHVyZSBoYXMgPj0gJ21pbl92b3Rlcycgdm90ZXMsIGl0IHdpbGwgYmUgc2VsZWN0ZWQuCgogICAgOnBhcmFtIGNvbnRleHQ6ICAgICAgICAgICB0aGUgZnVuY3Rpb24gY29udGV4dC4KICAgIAogICAgOnBhcmFtIGs6ICAgICAgICAgICAgICAgICBudW1iZXIgb2YgdG9wIGZlYXR1cmVzIHRvIHNlbGVjdCBmcm9tIGVhY2ggc3RhdGlzdGljYWwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY3Rpb24gb3IgbW9kZWwuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgOnBhcmFtIG1pbl92b3RlczogICAgICAgICBtaW5pbWFsIG51bWJlciBvZiB2b3RlcyAoZnJvbSBhIG1vZGVsIG9yIGJ5IHN0YXRpc3RpY2FsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKSBuZWVkZWQgZm9yIGEgZmVhdHVyZSB0byBiZSBzZWxlY3RlZC4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgQ2FuIGJlIHNwZWNpZmllZCBieSBwZXJjZW50YWdlIG9mIHZvdGVzIG9yIGFic29sdXRlCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIG51bWJlciBvZiB2b3Rlcy4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICA6cGFyYW0gbGFiZWxfY29sdW1uOiAgICAgIGdyb3VuZC10cnV0aCAoeSkgbGFiZWxzLgogICAgCiAgICA6cGFyYW0gc3RhdF9maWx0ZXJzOiAgICAgIHN0YXRpc3RpY2FsIGZ1bmN0aW9ucyB0byBhcHBseSB0byB0aGUgZmVhdHVyZXMKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKGZyb20gc2tsZWFybi5mZWF0dXJlX3NlbGVjdGlvbikuCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIAogICAgOnBhcmFtIG1vZGVsX2ZpbHRlcnM6ICAgICBtb2RlbHMgdG8gdXNlIGZvciBmZWF0dXJlIGV2YWx1YXRpb24sIGNhbiBiZSBzcGVjaWZpZWQgYnkKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbW9kZWwgbmFtZSAoZXguIExpbmVhclNWQyksIGZvcm1hbGl6ZWQganNvbiAoY29udGFpbnMgJ0NMQVNTJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgJ0ZJVCcsICdNRVRBJykgb3IgYSBwYXRoIHRvIHN1Y2gganNvbiBmaWxlLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAKICAgIDpwYXJhbSBtYXhfc2NhbGVkX3Njb3JlczogcHJvZHVjZSBmZWF0dXJlIHNjb3JlcyB0YWJsZSBzY2FsZWQgd2l0aCBtYXhfc2NhbGVyLgoKICAgIDpwYXJhbSBzYW1wbGVfcmF0aW86IHBlcmNlbnRhZ2Ugb2YgdGhlIGRhdGFzZXQgdGhlIHVzZXIgd2hpc2hlcyB0byBjb21wdXRlIHRoZSBmZWF0dXJlIHNlbGVjdGlvbiBwcm9jZXNzIG9uLgogICAgCiAgICA6cGFyYW0gb3V0cHV0X3ZlY3Rvcl9uYW1lOiBjcmVhdGVzIGEgbmV3IGZlYXR1cmUgdmVjdG9yIGNvbnRhaW5pbmcgb25seSB0aGUgaWRlbnRpZmllcyBmZWF0dXJlcy4KICAgIAogICAgOnBhcmFtIGlnbm9yZV90eXBlX2Vycm9yczogc2tpcHMgZGF0YXR5cGVzIHRoYXQgYXJlIG5laXRoZXIgZmxvYXQgb3IgaW50IHdpdGhpbiB0aGUgZmVhdHVyZSB2ZWN0b3IuCiAgICAKICAgIDpwYXJhbSBpc19mZWF0dXJlX3ZlY3RvcjogYm9vbCBzdGF0aW5nIGlmIHRoZSBkYXRhIGlzIHBhc3NlZCBhcyBhIGZlYXR1cmUgdmVjdG9yLgogICAgIiIiCiAgICAgICAgCiAgICAjIENoZWNrIGlmIGRmLm1ldGEgaXMgdmFsaWQsIGlmIGl0IGlzLCBsb29rIGZvciBhIGZlYXR1cmUgdmVjdG9yCiAgICBpZiBkZl9hcnRpZmFjdC5tZXRhOgogICAgICAgIGlmIGRmX2FydGlmYWN0Lm1ldGEua2luZCA9PSBtbHJ1bi5hcGkuc2NoZW1hcy5PYmplY3RLaW5kLmZlYXR1cmVfdmVjdG9yOgogICAgICAgICAgICBpc19mZWF0dXJlX3ZlY3RvciA9IFRydWUKICAgIAogICAgIyBMb29rIGluc2lkZSBtZXRhLnNwZWMubGFiZWxfZmVhdHVyZSB0byBpZGVudGlmeSB0aGUgbGFiZWxfY29sdW1uIGlmIHRoZSB1c2VyIGRpZCBub3Qgc3BlY2lmeSBpdAogICAgaWYgbGFiZWxfY29sdW1uIGlzIE5vbmU6CiAgICAgICAgaWYgaXNfZmVhdHVyZV92ZWN0b3I6CiAgICAgICAgICAgIGxhYmVsX2NvbHVtbiA9IGRmX2FydGlmYWN0Lm1ldGEuc3BlYy5sYWJlbF9mZWF0dXJlLnNwbGl0KCcuJylbMV0KICAgICAgICBlbHNlOgogICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdObyBsYWJlbF9jb2x1bW4gd2FzIGdpdmVuLCBwbGVhc2UgYWRkIGEgbGFiZWxfY29sdW1uLicpCiAgICAKICAgICMgVXNlIHRoZSBmZWF0dXJlIHZlY3RvciBhcyBkYXRhZnJhbWUKICAgIGRmID0gZGZfYXJ0aWZhY3QuYXNfZGYoKQogICAgCiAgICAjIEVuc3VyZSBrIGlzIG5vdCBiaWdnZXIgdGhhbiB0aGUgdGhlIHRvdGFsIG51bWJlciBvZiBmZWF0dXJlcwogICAgaWYgayA+IGRmLnNoYXBlWzFdOgogICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoZidLIGNhbm5vdCBiZSBiaWdnZXIgdGhhbiB0aGUgdG90YWwgbnVtYmVyIG9mIGZlYXR1cmVzICh7ZGYuc2hhcGVbMV19KS4gUGxlYXNlIGNob29zZSBhIHNtYWxsZXIgSy4nKQogICAgZWxpZiBrIDwgMToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYnSyBjYW5ub3QgYmUgc21hbGxlciB0aGFuIDEuIFBsZWFzZSBjaG9vc2UgYSBiaWdnZXIgSy4nKQogICAgICAgIAogICAgIyBDcmVhdGUgYSBzYW1wbGUgZGF0YWZyYW1lIG9mIHRoZSBvcmlnaW5hbCBmZWF0dXJlIHZlY3RvcgogICAgaWYgc2FtcGxlX3JhdGlvOgogICAgICAgIGRmID0gZGYuZ3JvdXBieShsYWJlbF9jb2x1bW4pLmFwcGx5KGxhbWJkYSB4OiB4LnNhbXBsZShmcmFjPXNhbXBsZV9yYXRpbykpLnJlc2V0X2luZGV4KGRyb3A9VHJ1ZSkKICAgICAgICBkZiA9IGRmLmRyb3BuYSgpCiAgICAgICAgCiAgICAjIFNldCBmZWF0dXJlIHZlY3RvciBhbmQgbGFiZWxzCiAgICB5ID0gZGYucG9wKGxhYmVsX2NvbHVtbikKICAgIFggPSBkZgogICAgCiAgICBpZiBucC5vYmplY3QgaW4gbGlzdChYLmR0eXBlcykgYW5kIGlnbm9yZV90eXBlX2Vycm9ycyBpcyBGYWxzZToKICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGYie2RmLnNlbGVjdF9kdHlwZXMoaW5jbHVkZT1bJ29iamVjdCddKS5jb2x1bW5zLnRvbGlzdCgpfSBhcmUgbmVpdGhlciBmbG9hdCBvciBpbnQuIikKICAgICAgICAKICAgICMgQ3JlYXRlIHNlbGVjdGVkIHN0YXRpc3RpY2FsIGVzdGltYXRvcnMKICAgIHN0YXRfZnVuY3Rpb25zX2xpc3QgPSB7c3RhdF9uYW1lOiBTZWxlY3RLQmVzdChjcmVhdGVfY2xhc3MoZidza2xlYXJuLmZlYXR1cmVfc2VsZWN0aW9uLntzdGF0X25hbWV9JyksIGspCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBzdGF0X25hbWUgaW4gc3RhdF9maWx0ZXJzfQogICAgcmVxdWlyZXNfYWJzID0gWydjaGkyJ10KCiAgICAjIFJ1biBzdGF0aXN0aWMgZmlsdGVycwogICAgc2VsZWN0ZWRfZmVhdHVyZXNfYWdnID0ge30KICAgIHN0YXRzX2RmID0gcGQuRGF0YUZyYW1lKGluZGV4PVguY29sdW1ucykuZHJvcG5hKCkKICAgICAgICAgICAgICAgIAogICAgZm9yIHN0YXRfbmFtZSwgc3RhdF9mdW5jIGluIHN0YXRfZnVuY3Rpb25zX2xpc3QuaXRlbXMoKToKICAgICAgICB0cnk6CiAgICAgICAgICAgIHBhcmFtcyA9IChYLCB5KSBpZiBzdGF0X25hbWUgaW4gcmVxdWlyZXNfYWJzIGVsc2UgKGFicyhYKSwgeSkKICAgICAgICAgICAgc3RhdCA9IHN0YXRfZnVuYy5maXQoKnBhcmFtcykKCiAgICAgICAgICAgICMgQ29sbGVjdCBzdGF0IGZ1bmN0aW9uIHJlc3VsdHMKICAgICAgICAgICAgc3RhdF9kZiA9IHBkLkRhdGFGcmFtZShpbmRleD1YLmNvbHVtbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sdW1ucz1bc3RhdF9uYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhPXN0YXQuc2NvcmVzXykKICAgICAgICAgICAgcGxvdF9zdGF0KGNvbnRleHQsIHN0YXRfbmFtZSwgc3RhdF9kZikKICAgICAgICAgICAgc3RhdHNfZGYgPSBzdGF0c19kZi5qb2luKHN0YXRfZGYpCgogICAgICAgICAgICAjIFNlbGVjdCBLIEJlc3QgZmVhdHVyZXMKICAgICAgICAgICAgc2VsZWN0ZWRfZmVhdHVyZXMgPSBYLmNvbHVtbnNbc3RhdF9mdW5jLmdldF9zdXBwb3J0KCldCiAgICAgICAgICAgIHNlbGVjdGVkX2ZlYXR1cmVzX2FnZ1tzdGF0X25hbWVdID0gc2VsZWN0ZWRfZmVhdHVyZXMKICAgICAgICAgICAgCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOgogICAgICAgICAgICBjb250ZXh0LmxvZ2dlci5pbmZvKGYiQ291bGRuJ3QgY2FsY3VsYXRlIHtzdGF0X25hbWV9IGJlY2F1c2Ugb2Y6IHtlfSIpCgogICAgIyBDcmVhdGUgbW9kZWxzIGZyb20gY2xhc3MgbmFtZSAvIGpzb24gZmlsZSAvIGpzb24gcGFyYW1zCiAgICBhbGxfc2tsZWFybl9lc3RpbWF0b3JzID0gZGljdChhbGxfZXN0aW1hdG9ycygpKSBpZiBsZW4obW9kZWxfZmlsdGVycykgPiAwIGVsc2Uge30KICAgIHNlbGVjdGVkX21vZGVscyA9IHt9CiAgICBmb3IgbW9kZWxfbmFtZSwgbW9kZWwgaW4gbW9kZWxfZmlsdGVycy5pdGVtcygpOgogICAgICAgIGlmICcuanNvbicgaW4gbW9kZWw6CiAgICAgICAgICAgIGN1cnJlbnRfbW9kZWwgPSBqc29uLmxvYWQob3Blbihtb2RlbCwgJ3InKSkKICAgICAgICAgICAgQ2xhc3NpZmllckNsYXNzID0gY3JlYXRlX2NsYXNzKGN1cnJlbnRfbW9kZWxbIk1FVEEiXVsiY2xhc3MiXSkKICAgICAgICAgICAgc2VsZWN0ZWRfbW9kZWxzW21vZGVsX25hbWVdID0gQ2xhc3NpZmllckNsYXNzKCoqY3VycmVudF9tb2RlbFsiQ0xBU1MiXSkKICAgICAgICBlbGlmIG1vZGVsIGluIGFsbF9za2xlYXJuX2VzdGltYXRvcnM6CiAgICAgICAgICAgIHNlbGVjdGVkX21vZGVsc1ttb2RlbF9uYW1lXSA9IGFsbF9za2xlYXJuX2VzdGltYXRvcnNbbW9kZWxfbmFtZV0oKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGN1cnJlbnRfbW9kZWwgPSBqc29uLmxvYWRzKG1vZGVsKSBpZiBpc2luc3RhbmNlKG1vZGVsLCBzdHIpIGVsc2UgY3VycmVudF9tb2RlbAogICAgICAgICAgICAgICAgQ2xhc3NpZmllckNsYXNzID0gY3JlYXRlX2NsYXNzKGN1cnJlbnRfbW9kZWxbIk1FVEEiXVsiY2xhc3MiXSkKICAgICAgICAgICAgICAgIHNlbGVjdGVkX21vZGVsc1ttb2RlbF9uYW1lXSA9IENsYXNzaWZpZXJDbGFzcygqKmN1cnJlbnRfbW9kZWxbIkNMQVNTIl0pCiAgICAgICAgICAgIGV4Y2VwdDoKICAgICAgICAgICAgICAgIGNvbnRleHQubG9nZ2VyLmluZm8oZid1bmFibGUgdG8gbG9hZCB7bW9kZWx9JykKCiAgICAjIFJ1biBtb2RlbCBmaWx0ZXJzCiAgICBtb2RlbHNfZGYgPSBwZC5EYXRhRnJhbWUoaW5kZXg9WC5jb2x1bW5zKQogICAgZm9yIG1vZGVsX25hbWUsIG1vZGVsIGluIHNlbGVjdGVkX21vZGVscy5pdGVtcygpOgogICAgICAgICMgVHJhaW4gbW9kZWwgYW5kIGdldCBmZWF0dXJlIGltcG9ydGFuY2UKICAgICAgICBzZWxlY3RfZnJvbV9tb2RlbCA9IFNlbGVjdEZyb21Nb2RlbChtb2RlbCkuZml0KFgsIHkpCiAgICAgICAgZmVhdHVyZV9pZHggPSBzZWxlY3RfZnJvbV9tb2RlbC5nZXRfc3VwcG9ydCgpCiAgICAgICAgZmVhdHVyZV9uYW1lcyA9IFguY29sdW1uc1tmZWF0dXJlX2lkeF0KICAgICAgICBzZWxlY3RlZF9mZWF0dXJlc19hZ2dbbW9kZWxfbmFtZV0gPSBmZWF0dXJlX25hbWVzLnRvbGlzdCgpCgogICAgICAgICMgQ29sbGVjdCBtb2RlbCBmZWF0dXJlIGltcG9ydGFuY2UKICAgICAgICBpZiBoYXNhdHRyKHNlbGVjdF9mcm9tX21vZGVsLmVzdGltYXRvcl8sICdjb2VmXycpOgogICAgICAgICAgICBzdGF0X2RmID0gc2VsZWN0X2Zyb21fbW9kZWwuZXN0aW1hdG9yXy5jb2VmXwogICAgICAgIGVsaWYgaGFzYXR0cihzZWxlY3RfZnJvbV9tb2RlbC5lc3RpbWF0b3JfLCAnZmVhdHVyZV9pbXBvcnRhbmNlc18nKToKICAgICAgICAgICAgc3RhdF9kZiA9IHNlbGVjdF9mcm9tX21vZGVsLmVzdGltYXRvcl8uZmVhdHVyZV9pbXBvcnRhbmNlc18KCiAgICAgICAgc3RhdF9kZiA9IHBkLkRhdGFGcmFtZShpbmRleD1YLmNvbHVtbnMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2x1bW5zPVttb2RlbF9uYW1lXSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9c3RhdF9kZlswXSkKICAgICAgICBtb2RlbHNfZGYgPSBtb2RlbHNfZGYuam9pbihzdGF0X2RmKQoKICAgICAgICBwbG90X3N0YXQoY29udGV4dCwgbW9kZWxfbmFtZSwgc3RhdF9kZikKCiAgICAjIENyZWF0ZSBmZWF0dXJlX3Njb3JlcyBERiB3aXRoIHN0YXQgJiBtb2RlbCBmaWx0ZXJzIHNjb3JlcwogICAgcmVzdWx0X21hdHJpeF9kZiA9IHBkLmNvbmNhdChbc3RhdHNfZGYsIG1vZGVsc19kZl0sIGF4aXM9MSwgc29ydD1GYWxzZSkKICAgIGNvbnRleHQubG9nX2RhdGFzZXQoa2V5PSdmZWF0dXJlX3Njb3JlcycsCiAgICAgICAgICAgICAgICAgICAgICAgIGRmPXJlc3VsdF9tYXRyaXhfZGYsCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9J2ZlYXR1cmVfc2NvcmVzLnBhcnF1ZXQnLAogICAgICAgICAgICAgICAgICAgICAgICBmb3JtYXQ9J3BhcnF1ZXQnKQogICAgaWYgbWF4X3NjYWxlZF9zY29yZXM6CiAgICAgICAgbm9ybWFsaXplZF9kZiA9IHJlc3VsdF9tYXRyaXhfZGYucmVwbGFjZShbbnAuaW5mLCAtbnAuaW5mXSwgbnAubmFuKS52YWx1ZXMKICAgICAgICBtaW5fbWF4X3NjYWxlciA9IE1pbk1heFNjYWxlcigpCiAgICAgICAgbm9ybWFsaXplZF9kZiA9IG1pbl9tYXhfc2NhbGVyLmZpdF90cmFuc2Zvcm0obm9ybWFsaXplZF9kZikKICAgICAgICBub3JtYWxpemVkX2RmID0gcGQuRGF0YUZyYW1lKGRhdGE9bm9ybWFsaXplZF9kZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbHVtbnM9cmVzdWx0X21hdHJpeF9kZi5jb2x1bW5zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaW5kZXg9cmVzdWx0X21hdHJpeF9kZi5pbmRleCkKICAgICAgICBjb250ZXh0LmxvZ19kYXRhc2V0KGtleT0nbWF4X3NjYWxlZF9zY29yZXNfZmVhdHVyZV9zY29yZXMnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZGY9bm9ybWFsaXplZF9kZiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsX3BhdGg9J21heF9zY2FsZWRfc2NvcmVzX2ZlYXR1cmVfc2NvcmVzLnBhcnF1ZXQnLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0PSdwYXJxdWV0JykKCiAgICAjIENyZWF0ZSBmZWF0dXJlIGNvdW50IERhdGFGcmFtZQogICAgZm9yIHRlc3RfbmFtZSBpbiBzZWxlY3RlZF9mZWF0dXJlc19hZ2c6CiAgICAgICAgcmVzdWx0X21hdHJpeF9kZlt0ZXN0X25hbWVdID0gWzEgaWYgeCBpbiBzZWxlY3RlZF9mZWF0dXJlc19hZ2dbdGVzdF9uYW1lXSBlbHNlIDAgZm9yIHggaW4gWC5jb2x1bW5zXQogICAgcmVzdWx0X21hdHJpeF9kZi5sb2NbOiwgJ251bV92b3RlcyddID0gcmVzdWx0X21hdHJpeF9kZi5zdW0oYXhpcz0xKQogICAgY29udGV4dC5sb2dfZGF0YXNldChrZXk9J3NlbGVjdGVkX2ZlYXR1cmVzX2NvdW50JywKICAgICAgICAgICAgICAgICAgICAgICAgZGY9cmVzdWx0X21hdHJpeF9kZiwKICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWxfcGF0aD0nc2VsZWN0ZWRfZmVhdHVyZXNfY291bnQucGFycXVldCcsCiAgICAgICAgICAgICAgICAgICAgICAgIGZvcm1hdD0ncGFycXVldCcpCgogICAgIyBIb3cgbWFueSB2b3RlcyBhcmUgbmVlZGVkIGZvciBhIGZlYXR1cmUgdG8gYmUgc2VsZWN0ZWQ/CiAgICBpZiBpc2luc3RhbmNlKG1pbl92b3RlcywgaW50KToKICAgICAgICB2b3Rlc19uZWVkZWQgPSBtaW5fdm90ZXMKICAgIGVsc2U6CiAgICAgICAgbnVtX2ZpbHRlcnMgPSBsZW4oc3RhdF9maWx0ZXJzKSArIGxlbihtb2RlbF9maWx0ZXJzKQogICAgICAgIHZvdGVzX25lZWRlZCA9IGludChucC5mbG9vcihudW1fZmlsdGVycyAqIG1heChtaW4obWluX3ZvdGVzLCAxKSwgMCkpKQogICAgY29udGV4dC5sb2dnZXIuaW5mbyhmJ3ZvdGVzIG5lZWRlZCB0byBiZSBzZWxlY3RlZDoge3ZvdGVzX25lZWRlZH0nKQoKICAgICMgQ3JlYXRlIGZpbmFsIGZlYXR1cmUgZGF0YWZyYW1lCiAgICBzZWxlY3RlZF9mZWF0dXJlcyA9IHJlc3VsdF9tYXRyaXhfZGZbcmVzdWx0X21hdHJpeF9kZi5udW1fdm90ZXMgPj0gdm90ZXNfbmVlZGVkXS5pbmRleC50b2xpc3QoKQogICAgZ29vZF9mZWF0dXJlX2RmID0gZGYubG9jWzosIHNlbGVjdGVkX2ZlYXR1cmVzXQogICAgZmluYWxfZGYgPSBwZC5jb25jYXQoW2dvb2RfZmVhdHVyZV9kZiwgeV0sIGF4aXM9MSkKICAgIGNvbnRleHQubG9nX2RhdGFzZXQoa2V5PSdzZWxlY3RlZF9mZWF0dXJlcycsCiAgICAgICAgICAgICAgICAgICAgICAgIGRmPWZpbmFsX2RmLAogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbF9wYXRoPSdzZWxlY3RlZF9mZWF0dXJlcy5wYXJxdWV0JywKICAgICAgICAgICAgICAgICAgICAgICAgZm9ybWF0PSdwYXJxdWV0JykKICAgIAogICAgIyBDcmVhdGluZyBhIG5ldyBmZWF0dXJlIHZlY3RvciBjb250YWluaW5nIG9ubHkgdGhlIGlkZW50aWZpZWQgdG9wIGZlYXR1cmVzCiAgICBpZiBpc19mZWF0dXJlX3ZlY3RvciBhbmQgZGZfYXJ0aWZhY3QubWV0YS5zcGVjLmZlYXR1cmVzIGFuZCBvdXRwdXRfdmVjdG9yX25hbWU6CgogICAgICAgICMgU2VsZWN0aW5nIHRoZSB0b3AgSyBmZWF0dXJlcyBmcm9tIG91ciB0b3AgZmVhdHVyZSBkYXRhZnJhbWUKICAgICAgICBzZWxlY3RlZF9mZWF0dXJlcyA9IHJlc3VsdF9tYXRyaXhfZGYuaGVhZChrKS5pbmRleAoKICAgICAgICAjIE1hdGNoIHRoZSBzZWxlY3RlZCBmZWF0dXJlIG5hbWVzIHRvIHRoZSBGUyBGZWF0dXJlIGFubm90YXRpb25zCiAgICAgICAgbWF0Y2hlZF9zZWxlY3Rpb25zID0gW2ZlYXR1cmUgZm9yIGZlYXR1cmUgaW4gbGlzdChkZl9hcnRpZmFjdC5tZXRhLnNwZWMuZmVhdHVyZXMpIGZvciBzZWxlY3RlZCBpbiBsaXN0KHNlbGVjdGVkX2ZlYXR1cmVzKSBpZiBmZWF0dXJlLmVuZHN3aXRoKHNlbGVjdGVkKV0KCiAgICAgICAgIyBEZWZpbmluZyBvdXIgbmV3IGZlYXR1cmUgdmVjdG9yCiAgICAgICAgdG9wX2ZlYXR1cmVzX2Z2ID0gZnMuRmVhdHVyZVZlY3RvcihvdXRwdXRfdmVjdG9yX25hbWUsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkX3NlbGVjdGlvbnMsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsYWJlbF9mZWF0dXJlPSJsYWJlbHMubGFiZWwiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj0nZmVhdHVyZSB2ZWN0b3IgY29tcG9zZWQgc3RyaWN0bHkgb2Ygb3VyIHRvcCBmZWF0dXJlcycpCgogICAgICAgICMgU2F2aW5nCiAgICAgICAgdG9wX2ZlYXR1cmVzX2Z2LnNhdmUoKQogICAgICAgIGZzLmdldF9vZmZsaW5lX2ZlYXR1cmVzKHRvcF9mZWF0dXJlc19mdiwgdGFyZ2V0PVBhcnF1ZXRUYXJnZXQoKSkKCiAgICAgICAgIyBMb2dnaW5nIG91ciBuZXcgZmVhdHVyZSB2ZWN0b3IgVVJJCiAgICAgICAgY29udGV4dC5sb2dfcmVzdWx0KCd0b3BfZmVhdHVyZXNfdmVjdG9yJywgdG9wX2ZlYXR1cmVzX2Z2LnVyaSk=
    commands: []
    code_origin: feature_selection.py
  affinity: null
verbose: false

